{"ast":null,"code":"var __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nimport { addStyles } from './dom';\nimport { Emitter, addDisposableListener } from './events';\nimport { CompositeDisposable, Disposable } from './lifecycle';\nexport class PopoutWindow extends CompositeDisposable {\n  get window() {\n    var _a, _b;\n    return (_b = (_a = this._window) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : null;\n  }\n  constructor(target, className, options) {\n    super();\n    this.target = target;\n    this.className = className;\n    this.options = options;\n    this._onWillClose = new Emitter();\n    this.onWillClose = this._onWillClose.event;\n    this._onDidClose = new Emitter();\n    this.onDidClose = this._onDidClose.event;\n    this._window = null;\n    this.addDisposables(this._onWillClose, this._onDidClose, {\n      dispose: () => {\n        this.close();\n      }\n    });\n  }\n  dimensions() {\n    if (!this._window) {\n      return null;\n    }\n    const left = this._window.value.screenX;\n    const top = this._window.value.screenY;\n    const width = this._window.value.innerWidth;\n    const height = this._window.value.innerHeight;\n    return {\n      top,\n      left,\n      width,\n      height\n    };\n  }\n  close() {\n    var _a, _b;\n    if (this._window) {\n      this._onWillClose.fire();\n      (_b = (_a = this.options).onWillClose) === null || _b === void 0 ? void 0 : _b.call(_a, {\n        id: this.target,\n        window: this._window.value\n      });\n      this._window.disposable.dispose();\n      this._window = null;\n      this._onDidClose.fire();\n    }\n  }\n  open() {\n    var _a, _b;\n    return __awaiter(this, void 0, void 0, function* () {\n      if (this._window) {\n        throw new Error('instance of popout window is already open');\n      }\n      const url = `${this.options.url}`;\n      const features = Object.entries({\n        top: this.options.top,\n        left: this.options.left,\n        width: this.options.width,\n        height: this.options.height\n      }).map(([key, value]) => `${key}=${value}`).join(',');\n      /**\n       * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/open\n       */\n      const externalWindow = window.open(url, this.target, features);\n      if (!externalWindow) {\n        /**\n         * Popup blocked\n         */\n        return null;\n      }\n      const disposable = new CompositeDisposable();\n      this._window = {\n        value: externalWindow,\n        disposable\n      };\n      disposable.addDisposables(Disposable.from(() => {\n        externalWindow.close();\n      }), addDisposableListener(window, 'beforeunload', () => {\n        /**\n         * before the main window closes we should close this popup too\n         * to be good citizens\n         *\n         * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event\n         */\n        this.close();\n      }));\n      const container = this.createPopoutWindowContainer();\n      if (this.className) {\n        container.classList.add(this.className);\n      }\n      (_b = (_a = this.options).onDidOpen) === null || _b === void 0 ? void 0 : _b.call(_a, {\n        id: this.target,\n        window: externalWindow\n      });\n      return new Promise((resolve, reject) => {\n        externalWindow.addEventListener('unload', e => {\n          // if page fails to load before unloading\n          // this.close();\n        });\n        externalWindow.addEventListener('load', () => {\n          /**\n           * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event\n           */\n          try {\n            const externalDocument = externalWindow.document;\n            externalDocument.title = document.title;\n            externalDocument.body.appendChild(container);\n            addStyles(externalDocument, window.document.styleSheets);\n            /**\n             * beforeunload must be registered after load for reasons I could not determine\n             * otherwise the beforeunload event will not fire when the window is closed\n             */\n            addDisposableListener(externalWindow, 'beforeunload', () => {\n              /**\n               * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event\n               */\n              this.close();\n            });\n            resolve(container);\n          } catch (err) {\n            // only except this is the DOM isn't setup. e.g. in a in correctly configured test\n            reject(err);\n          }\n        });\n      });\n    });\n  }\n  createPopoutWindowContainer() {\n    const el = document.createElement('div');\n    el.classList.add('dv-popout-window');\n    el.id = 'dv-popout-window';\n    el.style.position = 'absolute';\n    el.style.width = '100%';\n    el.style.height = '100%';\n    el.style.top = '0px';\n    el.style.left = '0px';\n    return el;\n  }\n}","map":{"version":3,"names":["__awaiter","thisArg","_arguments","P","generator","adopt","value","resolve","Promise","reject","fulfilled","step","next","e","rejected","result","done","then","apply","addStyles","Emitter","addDisposableListener","CompositeDisposable","Disposable","PopoutWindow","window","_a","_b","_window","constructor","target","className","options","_onWillClose","onWillClose","event","_onDidClose","onDidClose","addDisposables","dispose","close","dimensions","left","screenX","top","screenY","width","innerWidth","height","innerHeight","fire","call","id","disposable","open","Error","url","features","Object","entries","map","key","join","externalWindow","from","container","createPopoutWindowContainer","classList","add","onDidOpen","addEventListener","externalDocument","document","title","body","appendChild","styleSheets","err","el","createElement","style","position"],"sources":["E:/dockview.demo/node_modules/dockview-core/dist/esm/popoutWindow.js"],"sourcesContent":["var __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nimport { addStyles } from './dom';\nimport { Emitter, addDisposableListener } from './events';\nimport { CompositeDisposable, Disposable } from './lifecycle';\nexport class PopoutWindow extends CompositeDisposable {\n    get window() {\n        var _a, _b;\n        return (_b = (_a = this._window) === null || _a === void 0 ? void 0 : _a.value) !== null && _b !== void 0 ? _b : null;\n    }\n    constructor(target, className, options) {\n        super();\n        this.target = target;\n        this.className = className;\n        this.options = options;\n        this._onWillClose = new Emitter();\n        this.onWillClose = this._onWillClose.event;\n        this._onDidClose = new Emitter();\n        this.onDidClose = this._onDidClose.event;\n        this._window = null;\n        this.addDisposables(this._onWillClose, this._onDidClose, {\n            dispose: () => {\n                this.close();\n            },\n        });\n    }\n    dimensions() {\n        if (!this._window) {\n            return null;\n        }\n        const left = this._window.value.screenX;\n        const top = this._window.value.screenY;\n        const width = this._window.value.innerWidth;\n        const height = this._window.value.innerHeight;\n        return { top, left, width, height };\n    }\n    close() {\n        var _a, _b;\n        if (this._window) {\n            this._onWillClose.fire();\n            (_b = (_a = this.options).onWillClose) === null || _b === void 0 ? void 0 : _b.call(_a, {\n                id: this.target,\n                window: this._window.value,\n            });\n            this._window.disposable.dispose();\n            this._window = null;\n            this._onDidClose.fire();\n        }\n    }\n    open() {\n        var _a, _b;\n        return __awaiter(this, void 0, void 0, function* () {\n            if (this._window) {\n                throw new Error('instance of popout window is already open');\n            }\n            const url = `${this.options.url}`;\n            const features = Object.entries({\n                top: this.options.top,\n                left: this.options.left,\n                width: this.options.width,\n                height: this.options.height,\n            })\n                .map(([key, value]) => `${key}=${value}`)\n                .join(',');\n            /**\n             * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/open\n             */\n            const externalWindow = window.open(url, this.target, features);\n            if (!externalWindow) {\n                /**\n                 * Popup blocked\n                 */\n                return null;\n            }\n            const disposable = new CompositeDisposable();\n            this._window = { value: externalWindow, disposable };\n            disposable.addDisposables(Disposable.from(() => {\n                externalWindow.close();\n            }), addDisposableListener(window, 'beforeunload', () => {\n                /**\n                 * before the main window closes we should close this popup too\n                 * to be good citizens\n                 *\n                 * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event\n                 */\n                this.close();\n            }));\n            const container = this.createPopoutWindowContainer();\n            if (this.className) {\n                container.classList.add(this.className);\n            }\n            (_b = (_a = this.options).onDidOpen) === null || _b === void 0 ? void 0 : _b.call(_a, {\n                id: this.target,\n                window: externalWindow,\n            });\n            return new Promise((resolve, reject) => {\n                externalWindow.addEventListener('unload', (e) => {\n                    // if page fails to load before unloading\n                    // this.close();\n                });\n                externalWindow.addEventListener('load', () => {\n                    /**\n                     * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/load_event\n                     */\n                    try {\n                        const externalDocument = externalWindow.document;\n                        externalDocument.title = document.title;\n                        externalDocument.body.appendChild(container);\n                        addStyles(externalDocument, window.document.styleSheets);\n                        /**\n                         * beforeunload must be registered after load for reasons I could not determine\n                         * otherwise the beforeunload event will not fire when the window is closed\n                         */\n                        addDisposableListener(externalWindow, 'beforeunload', () => {\n                            /**\n                             * @see https://developer.mozilla.org/en-US/docs/Web/API/Window/beforeunload_event\n                             */\n                            this.close();\n                        });\n                        resolve(container);\n                    }\n                    catch (err) {\n                        // only except this is the DOM isn't setup. e.g. in a in correctly configured test\n                        reject(err);\n                    }\n                });\n            });\n        });\n    }\n    createPopoutWindowContainer() {\n        const el = document.createElement('div');\n        el.classList.add('dv-popout-window');\n        el.id = 'dv-popout-window';\n        el.style.position = 'absolute';\n        el.style.width = '100%';\n        el.style.height = '100%';\n        el.style.top = '0px';\n        el.style.left = '0px';\n        return el;\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}