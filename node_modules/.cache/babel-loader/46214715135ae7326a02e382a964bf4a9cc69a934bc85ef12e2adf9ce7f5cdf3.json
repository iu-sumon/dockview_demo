{"ast":null,"code":"import { shiftAbsoluteElementIntoView } from '../../dom';\nimport { addDisposableListener } from '../../events';\nimport { CompositeDisposable, Disposable, MutableDisposable } from '../../lifecycle';\nexport class PopupService extends CompositeDisposable {\n  constructor(root) {\n    super();\n    this.root = root;\n    this._active = null;\n    this._activeDisposable = new MutableDisposable();\n    this._element = document.createElement('div');\n    this._element.className = 'dv-popover-anchor';\n    this._element.style.position = 'relative';\n    this.root.prepend(this._element);\n    this.addDisposables(Disposable.from(() => {\n      this.close();\n    }), this._activeDisposable);\n  }\n  openPopover(element, position) {\n    var _a;\n    this.close();\n    const wrapper = document.createElement('div');\n    wrapper.style.position = 'absolute';\n    wrapper.style.zIndex = (_a = position.zIndex) !== null && _a !== void 0 ? _a : 'var(--dv-overlay-z-index)';\n    wrapper.appendChild(element);\n    const anchorBox = this._element.getBoundingClientRect();\n    const offsetX = anchorBox.left;\n    const offsetY = anchorBox.top;\n    wrapper.style.top = `${position.y - offsetY}px`;\n    wrapper.style.left = `${position.x - offsetX}px`;\n    this._element.appendChild(wrapper);\n    this._active = wrapper;\n    this._activeDisposable.value = new CompositeDisposable(addDisposableListener(window, 'pointerdown', event => {\n      var _a;\n      const target = event.target;\n      if (!(target instanceof HTMLElement)) {\n        return;\n      }\n      let el = target;\n      while (el && el !== wrapper) {\n        el = (_a = el === null || el === void 0 ? void 0 : el.parentElement) !== null && _a !== void 0 ? _a : null;\n      }\n      if (el) {\n        return; // clicked within popover\n      }\n      this.close();\n    }));\n    requestAnimationFrame(() => {\n      shiftAbsoluteElementIntoView(wrapper, this.root);\n    });\n  }\n  close() {\n    if (this._active) {\n      this._active.remove();\n      this._activeDisposable.dispose();\n      this._active = null;\n    }\n  }\n}","map":{"version":3,"names":["shiftAbsoluteElementIntoView","addDisposableListener","CompositeDisposable","Disposable","MutableDisposable","PopupService","constructor","root","_active","_activeDisposable","_element","document","createElement","className","style","position","prepend","addDisposables","from","close","openPopover","element","_a","wrapper","zIndex","appendChild","anchorBox","getBoundingClientRect","offsetX","left","offsetY","top","y","x","value","window","event","target","HTMLElement","el","parentElement","requestAnimationFrame","remove","dispose"],"sources":["E:/dockview.demo/node_modules/dockview-core/dist/esm/dockview/components/popupService.js"],"sourcesContent":["import { shiftAbsoluteElementIntoView } from '../../dom';\nimport { addDisposableListener } from '../../events';\nimport { CompositeDisposable, Disposable, MutableDisposable, } from '../../lifecycle';\nexport class PopupService extends CompositeDisposable {\n    constructor(root) {\n        super();\n        this.root = root;\n        this._active = null;\n        this._activeDisposable = new MutableDisposable();\n        this._element = document.createElement('div');\n        this._element.className = 'dv-popover-anchor';\n        this._element.style.position = 'relative';\n        this.root.prepend(this._element);\n        this.addDisposables(Disposable.from(() => {\n            this.close();\n        }), this._activeDisposable);\n    }\n    openPopover(element, position) {\n        var _a;\n        this.close();\n        const wrapper = document.createElement('div');\n        wrapper.style.position = 'absolute';\n        wrapper.style.zIndex = (_a = position.zIndex) !== null && _a !== void 0 ? _a : 'var(--dv-overlay-z-index)';\n        wrapper.appendChild(element);\n        const anchorBox = this._element.getBoundingClientRect();\n        const offsetX = anchorBox.left;\n        const offsetY = anchorBox.top;\n        wrapper.style.top = `${position.y - offsetY}px`;\n        wrapper.style.left = `${position.x - offsetX}px`;\n        this._element.appendChild(wrapper);\n        this._active = wrapper;\n        this._activeDisposable.value = new CompositeDisposable(addDisposableListener(window, 'pointerdown', (event) => {\n            var _a;\n            const target = event.target;\n            if (!(target instanceof HTMLElement)) {\n                return;\n            }\n            let el = target;\n            while (el && el !== wrapper) {\n                el = (_a = el === null || el === void 0 ? void 0 : el.parentElement) !== null && _a !== void 0 ? _a : null;\n            }\n            if (el) {\n                return; // clicked within popover\n            }\n            this.close();\n        }));\n        requestAnimationFrame(() => {\n            shiftAbsoluteElementIntoView(wrapper, this.root);\n        });\n    }\n    close() {\n        if (this._active) {\n            this._active.remove();\n            this._activeDisposable.dispose();\n            this._active = null;\n        }\n    }\n}\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}